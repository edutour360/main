<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EDUTOUR360 | Painel Admin</title>
  <meta name="description" content="EDUTOUR360 | Apresente sua escola de forma moderna com Tours 360° interativos">
  <meta name="keywords" content="EDUTOUR360, Tours 360°, Apresentação de escola, Interatividade, Tecnologia educacional">
  <!-- Favicon -->
  <link rel="shortcut icon" href="assets/images/favicon2.ico" type="image/Icon" />
  <!-- CSS do site -->
  <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
  <link rel="stylesheet" href="assets/css/animate.css" />
  <link rel="stylesheet" href="assets/css/lineicons.css" />
  <link rel="stylesheet" href="assets/css/ud-styles.css" />
  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    /* Estilo do header */
    .ud-header {
      background: #2563eb !important;
      color: #fff !important;
    }
    /* Estilo para seções do painel */
    div.supabase-update-section {
      background-color: #f9f9f9;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 2px 4px rgba(181, 158, 158, 0.1);
      margin-top: 20px;
    }
    .supabase-update-section h1, .supabase-update-section h2 {
      font-size: 32px;
      margin-bottom: 10px;
    }
    .supabase-update-section label {
      font-size: 16px;
      margin-bottom: 5px;
      display: block;
    }
    .supabase-update-section input[type="text"] {
      width: 50%;
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .supabase-update-section button {
      background-color: #2563eb;
      color: white;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      border-radius: 4px;
    }
    .supabase-update-section #logo-upload-status,
    .supabase-update-section #status-hero-all {
      margin-top: 10px;
      font-size: 14px;
      color: green;
    }
    #hero-desc-input {
      width: 1000px;
      height: 30px;
      margin-bottom: 10px;
      border: 1px solid #c6bebe;
      border-radius: 16px;
      padding: 8px;
    }
    /* Sticky header: fixa no topo ao rolar */
    .ud-header.sticky {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 999;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      animation: stickyFadeIn 0.3s;
    }
    @keyframes stickyFadeIn {
      from { opacity: 0; top: -20px; }
      to { opacity: 1; top: 0; }
    }
    /* Para evitar que o conteúdo fique escondido atrás do header sticky */
    body.has-sticky-header {
      padding-top: 90px; /* ajuste conforme altura do header */
    }
  </style>
</head>
<body>
  <!-- ====== Header ====== -->
  <header class="ud-header">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <nav class="navbar navbar-expand-lg">
            <a class="navbar-brand" href="index.html">
              <!-- Logo será atualizado dinamicamente -->
              <img src="" alt="Logo" id="site-logo" />
            </a>
            <button class="navbar-toggler">
              <span class="toggler-icon"></span>
              <span class="toggler-icon"></span>
              <span class="toggler-icon"></span>
            </button>
            <div class="navbar-collapse">
              <ul id="nav" class="navbar-nav mx-auto">
                <li class="nav-item"><a class="ud-menu-scroll" href="index.html">Inicio</a></li>
                <li class="nav-item"><a class="ud-menu-scroll" href="about.html">Sobre nós</a></li>
                <li class="nav-item"><a class="ud-menu-scroll" href="pricing.html">Preços</a></li>
                <li class="nav-item"><a class="ud-menu-scroll" href="about.html">Equipe</a></li>
                <li class="nav-item"><a class="ud-menu-scroll" href="contact.html">Contato</a></li>
                <!-- Submenu de páginas extras -->
                <li class="nav-item nav-item-has-children">
                  <a href="javascript:void(0)"> Pagina </a>
                  <ul class="ud-submenu">
                    <li class="ud-submenu-item"><a href="about.html" class="ud-submenu-link">Sobre nós</a></li>
                    <li class="ud-submenu-item"><a href="pricing.html" class="ud-submenu-link">Preços</a></li>
                    <li class="ud-submenu-item"><a href="contact.html" class="ud-submenu-link">Contato Page</a></li>
                    <li class="ud-submenu-item"><a href="blog.html" class="ud-submenu-link">Blog Page</a></li>
                    <li class="ud-submenu-item"><a href="blog-details.html" class="ud-submenu-link">Blog detalhes Page</a></li>
                    <li class="ud-submenu-item"><a href="login.html" class="ud-submenu-link">Sign In Page</a></li>
                    <li class="ud-submenu-item"><a href="404.html" class="ud-submenu-link">404 Erro</a></li>
                  </ul>
                </li>
              </ul>
            </div>
            <!-- Botões de login/cadastro/minha conta serão atualizados via JS -->
            <div class="navbar-btn d-none d-sm-inline-block"></div>
          </nav>
        </div>
      </div>
    </div>
  </header>

  <!-- ====== Painel de Controle ====== -->

  <main class="container mt-5"> 
    <section>
     <br> <br>
     
     
      <h1>Painel de Controle</h1>
      <p>Bem-vindo ao painel de controle. Aqui você pode gerenciar as configurações do site.</p>
    </section>

    <!-- ====== Upload de Logo ====== -->
    <section class="supabase-update-section">
      <h1>Atualize o Logo</h1>
      <p>Selecione uma nova imagem para o logo do site.</p>
      <form id="logo-upload-form">
        <label>Nova logo: <input type="file" id="logo-file" accept="image/*" required /></label>
        <button type="submit">Enviar e Definir como Logo</button>
        <span id="logo-upload-status"></span>
      </form>
    </section>

    <!-- ====== Atualização do Hero ====== -->
    <section id="supabase-update-section" class="supabase-update-section">
      <h1>Atualizar Hero (MVP)</h1>
      <form id="hero-mvp-form">
        <label for="hero-title-input">Título do Hero:</label>
        <input type="text" id="hero-title-input" placeholder="Carregando...">
        <br>
        <label for="hero-desc-input">Descrição do Hero:</label>
        <input type="text" id="hero-desc-input" placeholder="Carregando...">
        <br>
        <label for="hero-btn-text-input">Texto do Botão:</label>
        <input type="text" id="hero-btn-text-input" placeholder="Carregando...">
        <br>
        <label for="hero-btn-link-input">Link do Tour (iframe):</label>
        <input type="text" id="hero-btn-link-input" placeholder="Cole o link do tour 360°">
        <br>
        <button type="button" id="update-hero-all">Salvar Tudo</button>
        <span id="status-hero-all"></span>
      </form>
    </section>
  </main>

  <!-- ====== Scripts ====== -->
  <script>
    // Configuração global do site
    window.SITE_ID = 1;

    // Inicializa o Supabase
    const supabaseUrl = 'https://xbrahrggojoqtmxogsbz.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhicmFocmdnb2pvcXRteG9nc2J6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDczNTQ3NjIsImV4cCI6MjA2MjkzMDc2Mn0.VrBq_UNDTiUd8et6M60Wqy6E52iVuXrqaFEojzPZUB0';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    // Troca botões do header conforme login
    document.addEventListener('DOMContentLoaded', async () => {
      // Atualiza botões do header de acordo com o login
      const btnContainer = document.querySelector('.navbar-btn');
      if (!btnContainer) return;
      const { data: { session } } = await supabase.auth.getSession();
      btnContainer.innerHTML = '';
      if (session) {
        // Logado: Minha Conta e Sair
        const contaBtn = document.createElement('a');
        contaBtn.href = 'admin.html';
        contaBtn.className = 'ud-main-btn ud-login-btn';
        contaBtn.textContent = 'Minha Conta';
        btnContainer.appendChild(contaBtn);
        const sairBtn = document.createElement('a');
        sairBtn.href = '#';
        sairBtn.className = 'ud-main-btn ud-white-btn';
        sairBtn.textContent = 'Sair';
        sairBtn.addEventListener('click', async (e) => {
          e.preventDefault();
          await supabase.auth.signOut();
          window.location.href = 'login.html';
        });
        btnContainer.appendChild(sairBtn);
      } else {
        // Não logado: Entre e Cadastre-se
        const entreBtn = document.createElement('a');
        entreBtn.href = 'login.html';
        entreBtn.className = 'ud-main-btn ud-login-btn';
        entreBtn.textContent = 'Entre';
        btnContainer.appendChild(entreBtn);
        const cadastreBtn = document.createElement('a');
        cadastreBtn.href = 'signup.html';
        cadastreBtn.className = 'ud-main-btn ud-white-btn';
        cadastreBtn.textContent = 'Cadastre-se';
        btnContainer.appendChild(cadastreBtn);
      }
    });

    // Upload de logo e atualização da navbar
    document.getElementById('logo-upload-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      const status = document.getElementById('logo-upload-status');
      const fileInput = document.getElementById('logo-file');
      const file = fileInput.files[0];
      if (!file) {
        status.textContent = 'Selecione uma imagem.';
        return;
      }
      // 1. Faz upload para o Supabase Storage
      const filePath = `logos/${Date.now()}_${file.name}`;
      const { data: uploadData, error: uploadError } = await supabase.storage
        .from('images')
        .upload(filePath, file, { upsert: true });
      if (uploadError) {
        status.textContent = 'Erro ao enviar imagem: ' + uploadError.message;
        return;
      }
      // 2. Pega a URL pública
      const { data: urlData } = supabase
        .storage
        .from('images')
        .getPublicUrl(filePath);
      const logoUrl = urlData.publicUrl;
      // 3. Atualiza a linha existente no banco
      const { error: updateError } = await supabase
        .from('config')
        .upsert([
          { site_id: window.SITE_ID, key: 'logo_url', value: logoUrl }
        ], { onConflict: ['site_id', 'key'] });
      if (updateError) {
        status.textContent = 'Erro ao salvar logo no banco: ' + updateError.message;
        return;
      }
      status.textContent = 'Logo atualizada com sucesso!';
      // Atualiza o logo na navbar
      const logoImgNavbar = document.querySelector('.navbar-brand img');
      if (logoImgNavbar) logoImgNavbar.src = `${logoUrl}?v=${Date.now()}`;
      const logoImgById = document.getElementById("site-logo");
      if (logoImgById) logoImgById.src = `${logoUrl}?v=${Date.now()}`;
    });

    // Carrega e atualiza campos do Hero (título, descrição, botão, link)
    document.addEventListener('DOMContentLoaded', async () => {
      // Função para carregar valor do banco e preencher input
      async function loadField(key, inputId) {
        const input = document.getElementById(inputId);
        if (!input) return;
        input.placeholder = 'Carregando...';
        const { data, error } = await supabase
          .from('config')
          .select('value')
          .eq('key', key)
          .eq('site_id', window.SITE_ID)
          .maybeSingle();
        if (error) {
          input.placeholder = 'Erro ao carregar';
        } else {
          input.value = data?.value || '';
        }
      }
      // Carrega todos os campos do Hero
      loadField('hero_title', 'hero-title-input');
      loadField('hero_desc', 'hero-desc-input');
      loadField('hero_btn_text', 'hero-btn-text-input');
      loadField('hero_btn_link', 'hero-btn-link-input');

      // Salva todos os campos do Hero ao clicar no botão
      const updateBtn = document.getElementById('update-hero-all');
      if (updateBtn) {
        updateBtn.onclick = async () => {
          const titleInput = document.getElementById('hero-title-input');
          const descInput = document.getElementById('hero-desc-input');
          const btnTextInput = document.getElementById('hero-btn-text-input');
          const btnLinkInput = document.getElementById('hero-btn-link-input');
          const status = document.getElementById('status-hero-all');
          if (!titleInput || !descInput || !btnTextInput || !btnLinkInput || !status) return;
          status.textContent = 'Salvando...';
          status.style.color = '#2563eb';
          const updates = [
            { key: 'hero_title', value: titleInput.value },
            { key: 'hero_desc', value: descInput.value },
            { key: 'hero_btn_text', value: btnTextInput.value },
            { key: 'hero_btn_link', value: btnLinkInput.value }
          ].map(({key, value}) => ({
            site_id: window.SITE_ID,
            key,
            value,
          }));
          const { error } = await supabase
            .from('config')
            .upsert(updates, { onConflict: ['site_id', 'key'] });
          if (error) {
            status.textContent = 'Erro ao salvar!';
            status.style.color = 'red';
          } else {
            status.textContent = 'Salvo!';
            status.style.color = 'green';
            setTimeout(() => status.textContent = '', 2000);
          }
        };
      }
    });

    // Sticky Header: fixa o header no topo ao rolar a página
    window.addEventListener('scroll', function() {
      // Seleciona o header
      const header = document.querySelector('.ud-header');
      // Altura do header (ajuste se necessário)
      const stickyPoint = header.offsetTop;
      // Adiciona ou remove a classe 'sticky' conforme o scroll
      if (window.pageYOffset > stickyPoint) {
        header.classList.add('sticky');
        document.body.classList.add('has-sticky-header');
      } else {
        header.classList.remove('sticky');
        document.body.classList.remove('has-sticky-header');
      }
      // O logo permanece igual, pois já é atualizado pelo painel/admin
    });
  </script>
  <!-- JS do site -->
  <script src="assets/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/wow.min.js"></script>
  <script src="assets/js/main.js"></script>
  <script src="assets/js/configurador.js"></script>
</body>
</html>
